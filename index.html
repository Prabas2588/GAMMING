<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Movie Suggestion Board</title>
  <meta name="description" content="Suggest movies by uploading a poster image, writing a description, and giving a star rating. Browse, search, filter, sort, edit, and delete — all saved locally in your browser (no server needed)." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #0b0f14;
      --panel: #101823;
      --muted: #95a0b4;
      --text: #e7eef8;
      --brand: #6aa8ff;
      --brand-2:#a86aff;
      --danger:#ff6a86;
      --ok:#3ddc97;
      --border: #1d2a3b;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background: radial-gradient(1200px 600px at 80% -20%, rgba(106,168,255,.15), transparent 50%),
                  radial-gradient(1000px 500px at -10% 0%, rgba(168,106,255,.12), transparent 50%),
                  var(--bg);
      color:var(--text);
      line-height:1.5;
    }
    header{
      position:sticky; top:0; z-index:10;
      backdrop-filter:saturate(1.2) blur(10px);
      background: linear-gradient(0deg, rgba(16,24,35,.6), rgba(16,24,35,.6));
      border-bottom:1px solid var(--border);
    }
    .container{width:min(1200px, 92%); margin-inline:auto}
    .row{display:flex; gap:20px; flex-wrap:wrap}

    .brand{
      display:flex; align-items:center; gap:12px; padding:16px 0;
    }
    .brand .logo{width:38px; height:38px; border-radius:12px; background:linear-gradient(135deg, var(--brand), var(--brand-2)); box-shadow: var(--shadow); display:grid; place-items:center}
    .brand h1{font-size:20px; margin:0; letter-spacing:.3px}
    .brand small{display:block; color:var(--muted); font-weight:500}

    .toolbar{margin-left:auto; display:flex; align-items:center; gap:10px}
    .btn{border:1px solid var(--border); background:linear-gradient(180deg, #132033, #0e1826); color:var(--text); padding:10px 14px; border-radius:12px; cursor:pointer; transition:.2s; box-shadow:0 2px 0 rgba(255,255,255,.06) inset}
    .btn:hover{transform:translateY(-1px); border-color:#27405f}
    .btn:active{transform:translateY(0)}
    .btn.primary{background:linear-gradient(180deg, #3a6eea, #2b53b6); border-color:#214597}
    .btn.ghost{background:transparent}

    main{padding:28px 0 80px}

    /* Form Card */
    .card{background:linear-gradient(180deg, #111a27, #0b1420); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow)}
    .card .content{padding:20px}
    .card h2{margin:0 0 4px; font-size:22px}
    .sub{color:var(--muted); margin:0 0 16px}

    .grid{display:grid; grid-template-columns: 1.2fr 1fr; gap:18px}
    @media (max-width: 900px){.grid{grid-template-columns:1fr}}

    .drop{
      border:1.5px dashed #29405d; border-radius:16px; height:250px; display:grid; place-items:center; text-align:center; padding:18px; background:linear-gradient(180deg, #0d1624, #0b1420)
    }
    .drop.drag{border-color:var(--brand)}
    .drop input{display:none}
    .drop .hint{color:var(--muted)}
    .thumb{width:100%; height:250px; border-radius:14px; object-fit:cover; display:none}

    .field{display:flex; flex-direction:column; gap:8px}
    .field label{font-weight:600}
    textarea, input[type="text"]{background:#0d1725; border:1px solid var(--border); color:var(--text); padding:12px 14px; border-radius:12px; resize:vertical; min-height:110px}

    .stars{display:flex; gap:6px; align-items:center}
    .star{width:28px; height:28px; cursor:pointer; opacity:.6; transition:.15s}
    .star.active, .star:hover{opacity:1}

    .actions{display:flex; gap:10px; align-items:center; justify-content:flex-end}

    /* Filters */
    .filters{margin-top:18px; display:flex; gap:10px; flex-wrap:wrap}
    .chip{padding:8px 12px; border:1px solid var(--border); border-radius:999px; background:#0d1827}
    .input{background:#0d1725; border:1px solid var(--border); color:var(--text); padding:10px 12px; border-radius:12px}
    select.input{padding-right:34px}

    /* Gallery */
    .gallery{margin-top:18px; display:grid; grid-template-columns: repeat(3, 1fr); gap:18px}
    @media (max-width:1050px){.gallery{grid-template-columns: repeat(2, 1fr)}}
    @media (max-width:640px){.gallery{grid-template-columns: 1fr}}

    .card.movie{overflow:hidden; display:flex; flex-direction:column}
    .movie img{width:100%; height:220px; object-fit:cover}
    .movie .content{display:flex; flex-direction:column; gap:10px}
    .movie .meta{display:flex; align-items:center; justify-content:space-between; gap:10px}
    .rating small{color:var(--muted)}
    .muted{color:var(--muted)}
    .row-actions{display:flex; gap:8px}

    .empty{padding:30px; text-align:center; color:var(--muted)}

    /* Toast */
    .toast{position:fixed; bottom:24px; left:50%; transform:translateX(-50%) translateY(20px); background:#0f1a29; border:1px solid var(--border); color:var(--text); padding:12px 16px; border-radius:12px; opacity:0; pointer-events:none; transition:.25s; box-shadow:var(--shadow)}
    .toast.show{opacity:1; transform:translateX(-50%) translateY(0)}

    /* Toggle */
    .toggle{display:inline-flex; align-items:center; gap:8px}
    .switch{width:46px; height:26px; background:#1a2a40; border:1px solid var(--border); border-radius:999px; position:relative}
    .knob{position:absolute; width:20px; height:20px; background:#fff; border-radius:999px; top:2px; left:2px; transition:.2s}
    .switch.active .knob{left:24px}
  </style>
</head>
<body>
  <header>
    <div class="container row">
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
            <path d="M3 6h18v12H3z" stroke="white" stroke-width="1.4"/>
            <path d="M8 6v12M16 6v12" stroke="white" stroke-width="1.4"/>
            <circle cx="12" cy="12" r="2.8" fill="white"/>
          </svg>
        </div>
        <div>
          <h1>Movie Suggestion Board</h1>
          <small>Upload a poster • Add a description • Give stars</small>
        </div>
      </div>
      <div class="toolbar">
        <label class="toggle">
          <span class="muted">Dark Mode</span>
          <span id="themeSwitch" class="switch" role="switch" aria-checked="true" tabindex="0"><span class="knob"></span></span>
        </label>
        <button id="exportBtn" class="btn ghost" title="Export all suggestions to a JSON file">Export JSON</button>
        <label class="btn" for="importInput" title="Import suggestions from a JSON file">Import JSON</label>
        <input id="importInput" type="file" accept="application/json" hidden />
        <button id="clearBtn" class="btn" title="Remove everything">Clear All</button>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <div class="content">
        <h2>Suggest a Movie</h2>
        <p class="sub">Add your recommendation. Your data is saved locally in your browser — no account or server needed.</p>
        <div class="grid">
          <div>
            <div id="drop" class="drop" aria-label="Poster uploader" tabindex="0">
              <div>
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" style="opacity:.85">
                  <path d="M12 16V8m0 0-3 3m3-3 3 3" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
                  <rect x="3" y="4" width="18" height="14" rx="3" stroke="white" stroke-opacity=".65"/>
                </svg>
                <p><strong>Drag & drop</strong> a poster image here</p>
                <p class="hint">or <label for="file" class="btn" style="display:inline-block;">Browse</label> PNG/JPG (max ~10MB)</p>
              </div>
              <input id="file" type="file" accept="image/*" />
            </div>
            <img id="thumb" class="thumb" alt="Poster preview" />
          </div>

          <div style="display:flex; flex-direction:column; gap:14px">
            <div class="field">
              <label for="title">Movie Title</label>
              <input id="title" type="text" class="input" placeholder="e.g., Interstellar (2014)" maxlength="120"/>
            </div>
            <div class="field">
              <label for="desc">Why should we watch it?</label>
              <textarea id="desc" placeholder="Write a short description or review… (min 20 chars)" maxlength="400"></textarea>
              <small class="muted"><span id="count">0</span>/400</small>
            </div>
            <div class="field">
              <label>Rating</label>
              <div id="stars" class="stars" aria-label="Star rating" role="radiogroup"></div>
            </div>
            <div class="actions">
              <button id="resetBtn" class="btn ghost" type="button">Reset</button>
              <button id="submitBtn" class="btn primary" type="button">Add Suggestion</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="card" style="margin-top:18px">
      <div class="content">
        <div class="row" style="align-items:center">
          <h2 style="margin:0">Community Suggestions</h2>
          <div class="toolbar" style="margin-left:auto">
            <input id="search" class="input" placeholder="Search title or text…" />
            <select id="minRating" class="input" title="Filter by minimum rating">
              <option value="0">All ratings</option>
              <option value="5">5★ only</option>
              <option value="4">4★ and up</option>
              <option value="3">3★ and up</option>
              <option value="2">2★ and up</option>
              <option value="1">1★ and up</option>
            </select>
            <select id="sortBy" class="input" title="Sort">
              <option value="new">Newest first</option>
              <option value="top">Top rated</option>
              <option value="old">Oldest first</option>
              <option value="az">Title A→Z</option>
            </select>
          </div>
        </div>
        <div id="gallery" class="gallery"></div>
        <div id="empty" class="empty" style="display:none">No suggestions yet. Be the first to add one!</div>
      </div>
    </section>
  </main>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    // ===== Utilities =====
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const uid = () => Math.random().toString(36).slice(2) + Date.now().toString(36);
    const clamp = (n, a, b) => Math.max(a, Math.min(b, n));
    const formatDate = ts => new Date(ts).toLocaleString();

    function toast(msg){
      const t = $('#toast');
      t.textContent = msg; t.classList.add('show');
      setTimeout(()=> t.classList.remove('show'), 1800);
    }

    // ===== Local Storage Layer =====
    const KEY = 'movie_suggestions_v1';
    let state = { items: [], editingId: null, theme: 'dark' };

    function save(){ localStorage.setItem(KEY, JSON.stringify(state)); }

    function load(){
      try{ state = JSON.parse(localStorage.getItem(KEY)) || state; }catch{ /* ignore */ }
      if(!state.items) state.items = [];
      if(!state.theme) state.theme = 'dark';
    }

    // ===== Theme Toggle =====
    function applyTheme(){
      const isDark = state.theme === 'dark';
      document.documentElement.style.colorScheme = isDark ? 'dark' : 'light';
      const sw = $('#themeSwitch');
      sw.classList.toggle('active', !isDark);
      sw.setAttribute('aria-checked', String(!isDark));
    }

    function setupTheme(){
      const sw = $('#themeSwitch');
      sw.addEventListener('click',()=>{ state.theme = state.theme==='dark'?'light':'dark'; applyTheme(); save(); });
      sw.addEventListener('keydown',e=>{ if(e.key===' '||e.key==='Enter'){ e.preventDefault(); sw.click(); }});
      applyTheme();
    }

    // ===== Stars Component =====
    function renderStars(container, value=0){
      container.innerHTML = '';
      for(let i=1;i<=5;i++){
        const s = document.createElement('span');
        s.className = 'star' + (i<=value?' active':'');
        s.innerHTML = `\n          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden="true">\n            <path d="M12 3.8l2.2 4.5 5 .7-3.6 3.5.9 5-4.5-2.3-4.5 2.3.9-5L4.8 9l5-.7L12 3.8z" \n                  stroke="white" stroke-opacity=".9" fill="${i<=value? '#ffd75e' : 'transparent'}"/>\n          </svg>`;
        s.title = i + ' star' + (i>1?'s':'');
        s.dataset.value = i;
        container.appendChild(s);
      }
    }

    function setupFormStars(){
      const box = $('#stars');
      let current = 5;
      renderStars(box, current);
      box.addEventListener('click', e=>{
        const span = e.target.closest('.star');
        if(!span) return; current = Number(span.dataset.value)||current; renderStars(box, current);
      });
      return () => current;
    }

    // ===== Image Handling =====
    function fileToDataURL(file){
      return new Promise((res, rej)=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.onerror=rej; r.readAsDataURL(file); });
    }

    async function compressImage(dataUrl, maxW=1200, quality=.85){
      return new Promise(resolve=>{
        const img = new Image();
        img.onload = () => {
          const scale = Math.min(1, maxW / img.width);
          const w = Math.round(img.width * scale);
          const h = Math.round(img.height * scale);
          const c = document.createElement('canvas'); c.width=w; c.height=h;
          const ctx = c.getContext('2d');
          ctx.drawImage(img, 0,0,w,h);
          resolve(c.toDataURL('image/jpeg', quality));
        };
        img.src = dataUrl;
      });
    }

    // ===== Form Logic =====
    function setupForm(){
      const drop = $('#drop'); const input = $('#file'); const thumb = $('#thumb');
      const title = $('#title'); const desc = $('#desc'); const count = $('#count');
      const getStars = setupFormStars();

      let imageData = '';

      const setThumb = (src) => { if(src){ thumb.src = src; thumb.style.display='block'; drop.style.display='none'; } else { thumb.src=''; thumb.style.display='none'; drop.style.display='grid'; }}

      async function handleFile(file){
        if(!file || !file.type.startsWith('image/')){ toast('Please select an image file'); return; }
        const raw = await fileToDataURL(file);
        imageData = await compressImage(raw);
        setThumb(imageData);
      }

      ;['dragenter','dragover'].forEach(ev=>drop.addEventListener(ev,e=>{e.preventDefault(); drop.classList.add('drag');}))
      ;['dragleave','drop'].forEach(ev=>drop.addEventListener(ev,e=>{e.preventDefault(); if(ev==='drop'){} drop.classList.remove('drag');}))
      drop.addEventListener('drop', e=>{ const f = e.dataTransfer.files?.[0]; if(f) handleFile(f); })
      input.addEventListener('change', e=>{ const f = e.target.files?.[0]; if(f) handleFile(f); })

      desc.addEventListener('input', ()=>{ count.textContent = desc.value.length; })

      function resetForm(){ imageData=''; setThumb(''); title.value=''; desc.value=''; count.textContent='0'; renderStars($('#stars'), 5); }

      $('#resetBtn').addEventListener('click', resetForm);

      $('#submitBtn').addEventListener('click', ()=>{
        const rating = clamp(getStars(),1,5);
        const t = title.value.trim();
        const d = desc.value.trim();
        if(!imageData){ toast('Please upload a poster image'); return; }
        if(d.length < 20){ toast('Description must be at least 20 characters'); return; }
        const now = Date.now();
        if(state.editingId){
          const idx = state.items.findIndex(x=>x.id===state.editingId);
          if(idx>-1){ state.items[idx] = {...state.items[idx], image:imageData, title:t||'Untitled', desc:d, rating, updatedAt: now}; toast('Suggestion updated'); }
          state.editingId = null;
        } else {
          state.items.unshift({ id: uid(), image: imageData, title: t||'Untitled', desc: d, rating, createdAt: now, updatedAt: now });
          toast('Suggestion added');
        }
        save(); render(); resetForm();
      });

      return { resetForm, setForEdit: (item)=>{
        imageData = item.image; setThumb(imageData); title.value = item.title||''; desc.value=item.desc||''; renderStars($('#stars'), item.rating||5); count.textContent = desc.value.length; window.scrollTo({top:0, behavior:'smooth'});
      }}
    }

    // ===== Render Gallery =====
    function starRow(n){
      let html='';
      for(let i=1;i<=5;i++) html += `<svg width="18" height="18" viewBox="0 0 24 24" fill="${i<=n?'#ffd75e':'transparent'}" stroke="currentColor" style="opacity:${i<=n?1:.6}"><path d="M12 3.8l2.2 4.5 5 .7-3.6 3.5.9 5-4.5-2.3-4.5 2.3.9-5L4.8 9l5-.7L12 3.8z"/></svg>`;
      return html;
    }

    function applyFilters(items){
      const q = $('#search').value.toLowerCase().trim();
      const min = Number($('#minRating').value||0);
      let filtered = items.filter(x=> x.rating>=min && (!q || (x.title||'').toLowerCase().includes(q) || (x.desc||'').toLowerCase().includes(q)));
      const sort = $('#sortBy').value;
      if(sort==='new') filtered.sort((a,b)=> (b.updatedAt||b.createdAt) - (a.updatedAt||a.createdAt));
      if(sort==='old') filtered.sort((a,b)=> (a.updatedAt||a.createdAt) - (b.updatedAt||b.createdAt));
      if(sort==='top') filtered.sort((a,b)=> b.rating - a.rating || (b.updatedAt||b.createdAt)-(a.updatedAt||a.createdAt));
      if(sort==='az') filtered.sort((a,b)=> (a.title||'').localeCompare(b.title||''));
      return filtered;
    }

    function render(){
      const gallery = $('#gallery');
      const empty = $('#empty');
      const items = applyFilters([...state.items]);
      gallery.innerHTML = '';
      if(!items.length){ empty.style.display='block'; return; } else empty.style.display='none';

      for(const item of items){
        const card = document.createElement('article'); card.className='card movie'; card.dataset.id=item.id;
        card.innerHTML = `
          <img src="${item.image}" alt="Poster of ${item.title?.replace(/\"/g,'&quot;')||'movie'}" loading="lazy"/>
          <div class="content">
            <div class="meta">
              <h3 style="margin:0">${item.title || 'Untitled'}</h3>
              <div class="rating" title="${item.rating} star(s)">${starRow(item.rating)}</div>
            </div>
            <p class="muted" style="margin:0">${item.desc}</p>
            <div class="meta">
              <small class="muted">Updated: ${formatDate(item.updatedAt||item.createdAt)}</small>
              <div class="row-actions">
                <button class="btn ghost" data-act="edit">Edit</button>
                <button class="btn" data-act="delete">Delete</button>
              </div>
            </div>
          </div>`;
        gallery.appendChild(card);
      }
    }

    function setupListInteractions(formApi){
      $('#gallery').addEventListener('click', e=>{
        const btn = e.target.closest('button'); if(!btn) return;
        const card = e.target.closest('.movie'); if(!card) return;
        const id = card.dataset.id; const item = state.items.find(x=>x.id===id);
        if(btn.dataset.act==='delete'){
          if(confirm('Delete this suggestion?')){ state.items = state.items.filter(x=>x.id!==id); save(); render(); toast('Deleted'); }
        }
        if(btn.dataset.act==='edit'){
          state.editingId = id; formApi.setForEdit(item); toast('Edit mode: make changes and press "Update"'); $('#submitBtn').textContent='Update Suggestion';
        }
      });
    }

    // ===== Export / Import / Clear =====
    function setupDataOps(){
      $('#exportBtn').addEventListener('click', ()=>{
        const data = JSON.stringify(state.items, null, 2);
        const blob = new Blob([data], {type:'application/json'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
        a.download = 'movie_suggestions.json'; a.click(); URL.revokeObjectURL(a.href);
      });
      $('#importInput').addEventListener('change', async (e)=>{
        const file = e.target.files?.[0]; if(!file) return; try{
          const text = await file.text(); const arr = JSON.parse(text); if(!Array.isArray(arr)) throw new Error('Invalid file');
          // de-dup by id, or assign ids if missing
          for(const it of arr){ if(!it.id) it.id = uid(); it.updatedAt ||= it.createdAt || Date.now(); }
          state.items = arr.concat(state.items.filter(x=>!arr.find(y=>y.id===x.id)));
          save(); render(); toast('Imported');
        } catch(err){ toast('Import failed: ' + err.message); }
        e.target.value = '';
      });
      $('#clearBtn').addEventListener('click', ()=>{ if(confirm('This will remove all suggestions from this browser. Continue?')){ state.items=[]; save(); render(); toast('All cleared'); } });
    }

    // ===== Filters =====
    function setupFilters(){
      ['search','minRating','sortBy'].forEach(id=> $("#"+id).addEventListener('input', render));
    }

    // ===== Init =====
    let formApi;
    function init(){
      load(); setupTheme();
      formApi = setupForm();
      setupListInteractions(formApi);
      setupDataOps();
      setupFilters();
      render();
    }

    init();
  </script>
</body>
</html>
